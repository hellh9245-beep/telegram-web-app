<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const user = tg.initDataUnsafe?.user || {
        id: Math.floor(Math.random() * 1000000),
        first_name: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
        last_name: "",
        username: "user"
    };
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userKey = `user_${user.id}`;
    
    // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const defaultProducts = [
        {
            id: 1,
            name: "–°–º–∞—Ä—Ç—Ñ–æ–Ω Premium",
            price: 29990,
            description: "–ú–æ—â–Ω—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –æ—Ç–ª–∏—á–Ω–æ–π –∫–∞–º–µ—Ä–æ–π –∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º —Ä–∞–±–æ—Ç—ã –±–∞—Ç–∞—Ä–µ–∏.",
            image: "https://via.placeholder.com/300x200/667eea/ffffff?text=–°–º–∞—Ä—Ç—Ñ–æ–Ω",
            category: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"
        },
        {
            id: 2,
            name: "–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏",
            price: 4990,
            description: "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏ —Å —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º –∏ —á–∏—Å—Ç—ã–º –∑–≤—É–∫–æ–º.",
            image: "https://via.placeholder.com/300x200/764ba2/ffffff?text=–ù–∞—É—à–Ω–∏–∫–∏",
            category: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"
        },
        {
            id: 3,
            name: "–§—É—Ç–±–æ–ª–∫–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è",
            price: 1990,
            description: "–£–¥–æ–±–Ω–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º.",
            image: "https://via.placeholder.com/300x200/ff6b6b/ffffff?text=–§—É—Ç–±–æ–ª–∫–∞",
            category: "–û–¥–µ–∂–¥–∞"
        }
    ];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    let products = JSON.parse(localStorage.getItem('store_products')) || defaultProducts;
    let settings = JSON.parse(localStorage.getItem('store_settings')) || {
        theme: 'default',
        colors: { primary: '#667eea', secondary: '#764ba2' },
        storeName: '–ú–æ–π –º–∞–≥–∞–∑–∏–Ω',
        contactInfo: '@–≤–∞—à_username'
    };
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let userData = JSON.parse(localStorage.getItem(userKey)) || {
        cart: [],
        orders: []
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
    document.getElementById('products-count').textContent = products.length;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    document.getElementById('user-name').textContent = `${user.first_name} ${user.last_name || ''}`.trim();
    document.getElementById('user-id').textContent = `ID: ${user.id}`;
    document.getElementById('user-avatar').textContent = user.first_name[0] || 'üë§';
    
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    applySettings();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π
    updateVisitorsCount();

    function showTab(tabName) {
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ –∏ —É–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
        document.getElementById(tabName).classList.add('active');
        document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
        if (tabName === 'shop') {
            loadProducts();
            updateCategories();
        } else if (tabName === 'cart') {
            loadCart();
        } else if (tabName === 'profile') {
            loadProfile();
        } else if (tabName === 'admin') {
            loadAdminProducts();
        }
        // –î–ª—è –≤–∫–ª–∞–¥–∫–∏ settings –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    }

    function loadProducts() {
        const productsList = document.getElementById('products-list');
        productsList.innerHTML = '';
        
        if (products.length === 0) {
            productsList.innerHTML = `
                <div class="empty-state">
                    <i>üõí</i>
                    <h3>–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
                </div>
            `;
            return;
        }

        products.forEach((product, index) => {
            const productHTML = `
                <div class="product animated">
                    <div class="product-image">
                        ${product.image ? `<img src="${product.image}" alt="${product.name}">` : 'üéÅ –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞'}
                    </div>
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    ${product.category ? `<span style="background: var(--primary-color); color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">${product.category}</span>` : ''}
                    <div class="price">${product.price} —Ä—É–±.</div>
                    <button class="buy-btn" onclick="addToCart(${index})">
                        üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            `;
            productsList.innerHTML += productHTML;
        });
    }

    function updateCategories() {
        const categories = [...new Set(products.map(p => p.category).filter(Boolean))];
        const filterContainer = document.getElementById('category-filter');
        
        let categoriesHTML = '<button class="category-btn active" onclick="filterProducts(\'all\')">–í—Å–µ</button>';
        categories.forEach(category => {
            categoriesHTML += `<button class="category-btn" onclick="filterProducts('${category}')">${category}</button>`;
        });
        
        filterContainer.innerHTML = categoriesHTML;
    }

    function filterProducts(category) {
        document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        const productsList = document.getElementById('products-list');
        productsList.innerHTML = '';

        const filteredProducts = category === 'all' ? products : products.filter(p => p.category === category);
        
        if (filteredProducts.length === 0) {
            productsList.innerHTML = `
                <div class="empty-state">
                    <i>üîç</i>
                    <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
                </div>
            `;
            return;
        }
        
        filteredProducts.forEach((product, index) => {
            const originalIndex = products.findIndex(p => p.id === product.id);
            const productHTML = `
                <div class="product animated">
                    <div class="product-image">
                        ${product.image ? `<img src="${product.image}" alt="${product.name}">` : 'üéÅ –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞'}
                    </div>
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    ${product.category ? `<span style="background: var(--primary-color); color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">${product.category}</span>` : ''}
                    <div class="price">${product.price} —Ä—É–±.</div>
                    <button class="buy-btn" onclick="addToCart(${originalIndex})">
                        üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            `;
            productsList.innerHTML += productHTML;
        });
    }

    function addToCart(productIndex) {
        const product = products[productIndex];
        const existingItem = userData.cart.find(item => item.id === product.id);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            userData.cart.push({
                ...product,
                quantity: 1
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        localStorage.setItem(userKey, JSON.stringify(userData));
        
        tg.showPopup({
            title: "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É",
            message: `${product.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`
        });
    }

    function loadCart() {
        const cartItems = document.getElementById('cart-items');
        cartItems.innerHTML = '';
        
        if (userData.cart.length === 0) {
            cartItems.innerHTML = `
                <div class="empty-state">
                    <i>üõí</i>
                    <h3>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞</p>
                </div>
            `;
            document.getElementById('cart-total').style.display = 'none';
            return;
        }
        
        document.getElementById('cart-total').style.display = 'block';
        
        let totalPrice = 0;
        
        userData.cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            totalPrice += itemTotal;
            
            const cartItemHTML = `
                <div class="cart-item">
                    <div class="cart-item-image">
                        ${item.image ? `<img src="${item.image}" alt="${item.name}">` : 'üéÅ'}
                    </div>
                    <div class="cart-item-info">
                        <h4>${item.name}</h4>
                        <div class="price">${item.price} —Ä—É–±. x ${item.quantity} = ${itemTotal} —Ä—É–±.</div>
                    </div>
                    <div class="cart-item-controls">
                        <button class="quantity-btn" onclick="changeQuantity(${index}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="quantity-btn" onclick="changeQuantity(${index}, 1)">+</button>
                        <button class="admin-btn delete-btn" onclick="removeFromCart(${index})">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            cartItems.innerHTML += cartItemHTML;
        });
        
        document.getElementById('total-price').textContent = totalPrice;
    }

    function changeQuantity(index, change) {
        const item = userData.cart[index];
        item.quantity += change;
        
        if (item.quantity <= 0) {
            userData.cart.splice(index, 1);
        }
        
        localStorage.setItem(userKey, JSON.stringify(userData));
        loadCart();
    }

    function removeFromCart(index) {
        userData.cart.splice(index, 1);
        localStorage.setItem(userKey, JSON.stringify(userData));
        loadCart();
    }

    function checkout() {
        if (userData.cart.length === 0) {
            tg.showPopup({
                title: "‚ùå –û—à–∏–±–∫–∞",
                message: "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!"
            });
            return;
        }
        
        const totalPrice = userData.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        const order = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            items: [...userData.cart],
            total: totalPrice,
            status: "–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è"
        };
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑ –≤ –∏—Å—Ç–æ—Ä–∏—é
        userData.orders.unshift(order);
        
        // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
        userData.cart = [];
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
        localStorage.setItem(userKey, JSON.stringify(userData));
        
        tg.showPopup({
            title: "‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω",
            message: `–í–∞—à –∑–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${totalPrice} —Ä—É–±. –ø—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É!\n\n–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏: ${settings.contactInfo}`,
            buttons: [{type: "ok", text: "–ü–æ–Ω—è—Ç–Ω–æ"}]
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É
        loadCart();
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø—Ä–æ—Ñ–∏–ª—å —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
        showTab('profile');
    }

    function loadProfile() {
        const orderHistory = document.getElementById('order-history');
        orderHistory.innerHTML = '';
        
        if (userData.orders.length === 0) {
            orderHistory.innerHTML = `
                <div class="empty-state">
                    <i>üì¶</i>
                    <h3>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                    <p>–í–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p>
                </div>
            `;
            return;
        }
        
        userData.orders.forEach(order => {
            const orderHTML = `
                <div class="order-item">
                    <h4>–ó–∞–∫–∞–∑ #${order.id}</h4>
                    <p>–î–∞—Ç–∞: ${order.date}</p>
                    <p>–¢–æ–≤–∞—Ä–æ–≤: ${order.items.reduce((total, item) => total + item.quantity, 0)}</p>
                    <p>–°—É–º–º–∞: ${order.total} —Ä—É–±.</p>
                    <p>–°—Ç–∞—Ç—É—Å: ${order.status}</p>
                </div>
            `;
            orderHistory.innerHTML += orderHTML;
        });
    }

    function addProduct() {
        const name = document.getElementById('product-name').value;
        const price = document.getElementById('product-price').value;
        const description = document.getElementById('product-desc').value;
        const image = document.getElementById('product-image').value;
        const category = document.getElementById('product-category').value;

        if (!name || !price || !description) {
            tg.showPopup({
                title: "‚ùå –û—à–∏–±–∫–∞",
                message: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!"
            });
            return;
        }

        products.push({
            id: Date.now(),
            name: name,
            price: price,
            description: description,
            image: image,
            category: category
        });

        localStorage.setItem('store_products', JSON.stringify(products));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
        document.getElementById('products-count').textContent = products.length;
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('product-name').value = '';
        document.getElementById('product-price').value = '';
        document.getElementById('product-desc').value = '';
        document.getElementById('product-image').value = '';
        document.getElementById('product-category').value = '';

        tg.showPopup({
            title: "‚úÖ –£—Å–ø–µ—Ö",
            message: "–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!"
        });

        loadAdminProducts();
    }

    function loadAdminProducts() {
        const adminProductsContainer = document.getElementById('admin-products');
        adminProductsContainer.innerHTML = '';
        
        if (products.length === 0) {
            adminProductsContainer.innerHTML = '<p>–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
            return;
        }
        
        products.forEach((product, index) => {
            const productHTML = `
                <div class="product">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <div class="price">${product.price} —Ä—É–±.</div>
                    <div class="admin-controls">
                        <button class="admin-btn edit-btn" onclick="editProduct(${index})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="admin-btn delete-btn" onclick="deleteProduct(${index})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `;
            adminProductsContainer.innerHTML += productHTML;
        });
    }

    function editProduct(index) {
        const product = products[index];
        
        document.getElementById('product-name').value = product.name;
        document.getElementById('product-price').value = product.price;
        document.getElementById('product-desc').value = product.description;
        document.getElementById('product-image').value = product.image || '';
        document.getElementById('product-category').value = product.category || '';
        
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç–æ–≤–∞—Ä
        products.splice(index, 1);
        localStorage.setItem('store_products', JSON.stringify(products));
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
        document.getElementById('products-count').textContent = products.length;
        
        loadAdminProducts();
        
        tg.showPopup({
            title: "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
            message: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä' –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π"
        });
    }

    function deleteProduct(index) {
        if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
            products.splice(index, 1);
            localStorage.setItem('store_products', JSON.stringify(products));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
            document.getElementById('products-count').textContent = products.length;
            
            loadAdminProducts();
            
            tg.showPopup({
                title: "‚úÖ –£–¥–∞–ª–µ–Ω–æ",
                message: "–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞"
            });
        }
    }

    function applySettings() {
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
        document.body.className = '';
        if (settings.theme === 'dark') {
            document.body.classList.add('theme-dark');
        } else if (settings.theme === 'modern') {
            document.body.classList.add('theme-modern');
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤
        if (settings.colors) {
            document.documentElement.style.setProperty('--primary-color', settings.colors.primary);
            document.documentElement.style.setProperty('--secondary-color', settings.colors.secondary);
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        if (settings.storeName) {
            document.querySelector('h1').textContent = settings.storeName;
            document.getElementById('store-name').value = settings.storeName;
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        if (settings.contactInfo) {
            document.getElementById('contact-info').value = settings.contactInfo;
        }
    }

    function changeTheme(theme) {
        settings.theme = theme;
        localStorage.setItem('store_settings', JSON.stringify(settings));
        applySettings();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç–µ–º
        document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.theme-btn[onclick="changeTheme('${theme}')"]`).classList.add('active');
    }

    function changeColorScheme(primary, secondary) {
        settings.colors = { primary, secondary };
        localStorage.setItem('store_settings', JSON.stringify(settings));
        applySettings();
    }

    function saveSettings() {
        settings.storeName = document.getElementById('store-name').value;
        settings.contactInfo = document.getElementById('contact-info').value;
        localStorage.setItem('store_settings', JSON.stringify(settings));
        
        tg.showPopup({
            title: "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",
            message: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã"
        });
        
        applySettings();
    }

    function updateVisitorsCount() {
        // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π
        const visitors = Math.floor(Math.random() * 100) + 1;
        document.getElementById('visitors-count').textContent = visitors;
    }
</script>
